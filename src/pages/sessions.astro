---
import { useStoryblokApi } from '@storyblok/astro'
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import About from "@components/about.astro";
import Cta from "@components/cta.astro";

const storyblokApi = useStoryblokApi()

// Fetch articles
const { data } = await storyblokApi.get('cdn/stories', {
  content_type: 'AllArticles', // Use the content type you've set up in Storyblok
  sort_by: 'created_at:desc' // Sort articles by creation date
});

// Transform Storyblok stories into a more usable format
const articles = data.stories.map((story) => ({
  id: story.id,
  title: story.content.title,
  description: story.content.description,
  image: story.content.image,
  publishedAt: new Date(story.created_at).toLocaleDateString(),
  slug: story.slug
}));
---

<Layout title="Sessions">
  <Container>
    <Sectionhead>
      <Fragment slot="title">Sessions</Fragment>
      <Fragment slot="desc">
        We write about building startups and thoughts going on our mind.
      </Fragment>
    </Sectionhead>
    <main class="mt-16">
      <section class="grid md:grid-cols-3 gap-10">
        {articles.map((article) => (
          <div class="group">
            {article.image && (
              <img 
                src={article.image} 
                alt={article.title} 
                class="w-full rounded-md mb-4"
              />
            )}
            <h3 class="text-xl font-semibold mb-2">{article.title}</h3>
            <p class="text-gray-600 mb-4">{article.description}</p>
            <a 
              href={`/articles/${article.slug}`} 
              class="text-blue-500 hover:underline"
            >
              Read more
            </a>
            <p class="text-sm text-gray-500">Published on {article.publishedAt}</p>
          </div>
        ))}
      </section>
      <About />
      <Cta />
    </main>
  </Container>
</Layout>
